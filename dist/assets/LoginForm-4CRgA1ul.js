import{j as e}from"./ui-BL0XK98a.js";import{r as t,u as M}from"./router-jYBwsfRB.js";import{C as U,a as V,b as H,c as O,d as R,A as v,e as j,f as w,L as c,S as z,g as G,h as J,i as K,j as Q,I as h,B as D,k as u}from"./auth.service-CJ0bslbb.js";import{u as W}from"./index-CQGT0cvf.js";import"./vendor-gH-7aFTg.js";import"./utils-CjxovF-h.js";function se(){const{login:F}=W(),[n,S]=t.useState(""),[l,N]=t.useState(""),[g,x]=t.useState(void 0),[p,A]=t.useState([]),[d,r]=t.useState(""),[y,f]=t.useState(""),[o,C]=t.useState(!1),[L,E]=t.useState(!1),[i,P]=t.useState(""),[m,b]=t.useState(""),[I,T]=t.useState(!1),k=M();t.useEffect(()=>{(async()=>{try{const a=await u.getEntidades();A(a),a.length===1&&x(a[0].entidadeId)}catch(a){console.error("Erro ao carregar entidades:",a),r("Erro ao carregar entidades. Tente novamente.")}})()},[]);const q=async s=>{if(s.preventDefault(),r(""),f(""),!n||!l){r("Por favor, preencha todos os campos");return}if(!n.includes("@")){r("Por favor, insira um email válido");return}if(p.length>1&&!g){r("Por favor, selecione uma entidade");return}C(!0);try{localStorage.clear(),sessionStorage.clear();const a=await u.login({email:n,password:l,entidadeId:g||void 0});if(a.user?.trocaSenha){E(!0);return}if(a.auth?.accessToken&&a.user)F(n,l),k("/main");else throw new Error("Dados de autenticação incompletos")}catch(a){localStorage.removeItem("jwtToken"),localStorage.removeItem("userData"),a instanceof Error&&(r(a.message),console.error("Erro no login:",a))}finally{C(!1)}},B=async s=>{if(s.preventDefault(),r(""),f(""),!i||!m){r("Por favor, preencha todos os campos");return}if(i.length<6){r("A nova senha deve ter pelo menos 6 caracteres");return}if(i!==m){r("As senhas não coincidem");return}T(!0);try{const a=u.getUser();if(!a){r("Usuário não encontrado. Faça login novamente.");return}await u.changePassword(a.codigo,{newPassword:i,confirmPassword:m}),r(""),E(!1),P(""),b(""),S(""),N(""),x(void 0),f("Senha alterada com sucesso! Faça login com sua nova senha.")}catch(a){console.error("Erro ao trocar senha:",a),r("Erro ao trocar senha. Tente novamente.")}finally{T(!1)}};return e.jsx("div",{className:"min-h-screen flex items-center justify-center bg-blue-900 py-12 px-4 sm:px-6 lg:px-8",children:e.jsxs(U,{className:"w-full max-w-md",children:[e.jsxs(V,{className:"space-y-1",children:[e.jsx(H,{className:"text-center",children:"ClinicaTech"}),e.jsx(O,{className:"text-center",children:"Faça login para acessar o sistema"})]}),e.jsx(R,{children:L?e.jsxs("form",{onSubmit:B,className:"space-y-4",children:[e.jsxs("div",{className:"text-center mb-4",children:[e.jsx("h3",{className:"text-lg font-semibold",children:"Troca de Senha Obrigatória"}),e.jsx("p",{className:"text-sm text-gray-600",children:"Por segurança, você deve trocar sua senha antes de continuar."})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx(c,{htmlFor:"newPassword",children:"Nova Senha"}),e.jsx(h,{id:"newPassword",type:"password",value:i,onChange:s=>P(s.target.value),placeholder:"Digite sua nova senha",required:!0})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx(c,{htmlFor:"confirmPassword",children:"Confirmar Nova Senha"}),e.jsx(h,{id:"confirmPassword",type:"password",value:m,onChange:s=>b(s.target.value),placeholder:"Confirme sua nova senha",required:!0})]}),d&&e.jsxs(v,{variant:"destructive",children:[e.jsx(j,{className:"h-4 w-4"}),e.jsx(w,{children:d})]}),e.jsx(D,{type:"submit",className:"w-full",disabled:I,children:I?"Trocando senha...":"Trocar Senha"})]}):e.jsxs("form",{onSubmit:q,className:"space-y-4",children:[d&&e.jsxs(v,{variant:"destructive",children:[e.jsx(j,{className:"h-4 w-4"}),e.jsx(w,{children:d})]}),y&&e.jsxs(v,{className:"border-green-200 bg-green-50 text-green-800",children:[e.jsx(j,{className:"h-4 w-4"}),e.jsx(w,{children:y})]}),p.length>1&&e.jsxs("div",{className:"space-y-2",children:[e.jsx(c,{htmlFor:"entidade",children:"Entidade"}),e.jsxs(z,{value:g?.toString()||"",onValueChange:s=>x(parseInt(s)),disabled:o,children:[e.jsx(G,{children:e.jsx(J,{placeholder:"Selecione uma entidade"})}),e.jsx(K,{children:p.map(s=>e.jsx(Q,{value:s.entidadeId.toString(),children:s.nome},s.entidadeId))})]})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx(c,{htmlFor:"email",children:"E-mail"}),e.jsx(h,{id:"email",type:"email",placeholder:"seu.email@empresa.com",value:n,autoComplete:"email",onChange:s=>S(s.target.value),disabled:o})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx(c,{htmlFor:"password",children:"Senha"}),e.jsx(h,{id:"password",type:"password",placeholder:"Digite sua senha",value:l,onChange:s=>N(s.target.value),disabled:o})]}),e.jsx(D,{type:"submit",className:"w-full",disabled:o,children:o?"Entrando...":"Entrar"}),e.jsx("div",{className:"text-sm text-muted-foreground text-center mt-4",children:e.jsx("p",{children:"ClinicaTech Sistemas"})})]})})]})})}export{se as LoginForm};
//# sourceMappingURL=LoginForm-4CRgA1ul.js.map
