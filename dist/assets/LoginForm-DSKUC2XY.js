import{u as M,r as t,a as U,j as e}from"./index-DlgfZxrT.js";import{C as V,a as H,b as O,c as R,d as z,A as j,e as f,f as w,L as i,S as G,g as J,h as K,i as Q,j as W,I as m,B as D,k as u}from"./auth.service-BPAazZtu.js";function Z(){const{login:F}=M(),[n,S]=t.useState(""),[l,N]=t.useState(""),[g,x]=t.useState(void 0),[p,A]=t.useState([]),[d,r]=t.useState(""),[y,v]=t.useState(""),[o,C]=t.useState(!1),[L,E]=t.useState(!1),[c,P]=t.useState(""),[h,b]=t.useState(""),[I,T]=t.useState(!1),k=U();t.useEffect(()=>{(async()=>{try{const a=await u.getEntidades();A(a),a.length===1&&x(a[0].entidadeId)}catch(a){console.error("Erro ao carregar entidades:",a),r("Erro ao carregar entidades. Tente novamente.")}})()},[]);const q=async s=>{if(s.preventDefault(),r(""),v(""),!n||!l){r("Por favor, preencha todos os campos");return}if(!n.includes("@")){r("Por favor, insira um email válido");return}if(p.length>1&&!g){r("Por favor, selecione uma entidade");return}C(!0);try{localStorage.clear(),sessionStorage.clear();const a=await u.login({email:n,password:l,entidadeId:g||void 0});if(a.user?.trocaSenha){E(!0);return}if(a.auth?.accessToken&&a.user)F(n,l),k("/main");else throw new Error("Dados de autenticação incompletos")}catch(a){localStorage.removeItem("jwtToken"),localStorage.removeItem("userData"),a instanceof Error&&(r(a.message),console.error("Erro no login:",a))}finally{C(!1)}},B=async s=>{if(s.preventDefault(),r(""),v(""),!c||!h){r("Por favor, preencha todos os campos");return}if(c.length<6){r("A nova senha deve ter pelo menos 6 caracteres");return}if(c!==h){r("As senhas não coincidem");return}T(!0);try{const a=u.getUser();if(!a){r("Usuário não encontrado. Faça login novamente.");return}await u.changePassword(a.codigo,{newPassword:c,confirmPassword:h}),r(""),E(!1),P(""),b(""),S(""),N(""),x(void 0),v("Senha alterada com sucesso! Faça login com sua nova senha.")}catch(a){console.error("Erro ao trocar senha:",a),r("Erro ao trocar senha. Tente novamente.")}finally{T(!1)}};return e.jsx("div",{className:"min-h-screen flex items-center justify-center bg-blue-900 py-12 px-4 sm:px-6 lg:px-8",children:e.jsxs(V,{className:"w-full max-w-md",children:[e.jsxs(H,{className:"space-y-1",children:[e.jsx(O,{className:"text-center",children:"ClinicaTech"}),e.jsx(R,{className:"text-center",children:"Faça login para acessar o sistema"})]}),e.jsx(z,{children:L?e.jsxs("form",{onSubmit:B,className:"space-y-4",children:[e.jsxs("div",{className:"text-center mb-4",children:[e.jsx("h3",{className:"text-lg font-semibold",children:"Troca de Senha Obrigatória"}),e.jsx("p",{className:"text-sm text-gray-600",children:"Por segurança, você deve trocar sua senha antes de continuar."})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx(i,{htmlFor:"newPassword",children:"Nova Senha"}),e.jsx(m,{id:"newPassword",type:"password",value:c,onChange:s=>P(s.target.value),placeholder:"Digite sua nova senha",required:!0})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx(i,{htmlFor:"confirmPassword",children:"Confirmar Nova Senha"}),e.jsx(m,{id:"confirmPassword",type:"password",value:h,onChange:s=>b(s.target.value),placeholder:"Confirme sua nova senha",required:!0})]}),d&&e.jsxs(j,{variant:"destructive",children:[e.jsx(f,{className:"h-4 w-4"}),e.jsx(w,{children:d})]}),e.jsx(D,{type:"submit",className:"w-full",disabled:I,children:I?"Trocando senha...":"Trocar Senha"})]}):e.jsxs("form",{onSubmit:q,className:"space-y-4",children:[d&&e.jsxs(j,{variant:"destructive",children:[e.jsx(f,{className:"h-4 w-4"}),e.jsx(w,{children:d})]}),y&&e.jsxs(j,{className:"border-green-200 bg-green-50 text-green-800",children:[e.jsx(f,{className:"h-4 w-4"}),e.jsx(w,{children:y})]}),p.length>1&&e.jsxs("div",{className:"space-y-2",children:[e.jsx(i,{htmlFor:"entidade",children:"Entidade"}),e.jsxs(G,{value:g?.toString()||"",onValueChange:s=>x(parseInt(s)),disabled:o,children:[e.jsx(J,{children:e.jsx(K,{placeholder:"Selecione uma entidade"})}),e.jsx(Q,{children:p.map(s=>e.jsx(W,{value:s.entidadeId.toString(),children:s.nome},s.entidadeId))})]})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx(i,{htmlFor:"email",children:"Email"}),e.jsx(m,{id:"email",type:"email",placeholder:"seu.email@empresa.com",value:n,onChange:s=>S(s.target.value),disabled:o})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx(i,{htmlFor:"password",children:"Senha"}),e.jsx(m,{id:"password",type:"password",placeholder:"Digite sua senha",value:l,onChange:s=>N(s.target.value),disabled:o})]}),e.jsx(D,{type:"submit",className:"w-full",disabled:o,children:o?"Entrando...":"Entrar"}),e.jsx("div",{className:"text-sm text-muted-foreground text-center mt-4",children:e.jsx("p",{children:"ClinicaTech Sistemas"})})]})})]})})}export{Z as LoginForm};
//# sourceMappingURL=LoginForm-DSKUC2XY.js.map
